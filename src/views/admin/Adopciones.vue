<template><div class="fade-in"><h2 class="mb-4"><i class="bi bi-clipboard-check me-2"></i>Gestión de Adopciones</h2><Loading v-if="cargando"/><div v-else class="card"><div class="card-body"><div class="table-responsive"><table class="table table-hover"><thead><tr><th>Solicitante</th><th>Animal</th><th>Organización</th><th>Fecha</th><th>Estado</th><th>Acciones</th></tr></thead><tbody><tr v-for="adopcion in adopciones" :key="adopcion.idAdopcion"><td>{{ nombreCompleto(adopcion.usuario) }}</td><td>{{ adopcion.animal.nombre }} ({{ adopcion.animal.especie }})</td><td>{{ adopcion.animal.organizacion?.nombreOrganizacion }}</td><td>{{ formatearFecha(adopcion.fechaSolicitud) }}</td><td><span class="badge" :class="`bg-${colorPorEstado(adopcion.estado)}`">{{ formatearEstado(adopcion.estado) }}</span></td><td><button v-if="adopcion.estado==='Pendiente'" class="btn btn-sm btn-success me-1" @click="cambiarEstado(adopcion,'Aprobada')"><i class="bi bi-check-circle"></i></button><button v-if="adopcion.estado==='Pendiente'" class="btn btn-sm btn-danger" @click="cambiarEstado(adopcion,'Rechazada')"><i class="bi bi-x-circle"></i></button></td></tr></tbody></table></div></div></div></div></template>
<script>
import {ref,onMounted} from 'vue';
import Loading from '../../components/common/Loading.vue';
import adopcionService from '../../services/adopcionService';
import {toast,manejarErrorAPI} from '../../utils/alertas';
import {colorPorEstado,formatearEstado,formatearFecha,nombreCompleto} from '../../utils/helpers';
export default{name:'AdminAdopciones',components:{Loading},setup(){const cargando=ref(true);const adopciones=ref([]);const cargar=async()=>{try{const r=await adopcionService.getAll();adopciones.value=r.data;}catch(e){manejarErrorAPI(e);}finally{cargando.value=false;}};const cambiarEstado=async(a,estado)=>{try{await adopcionService.update(a.idAdopcion,{...a,estado});toast(`Adopción ${estado.toLowerCase()}`,'success');await cargar();}catch(e){manejarErrorAPI(e);}};onMounted(()=>cargar());return{cargando,adopciones,cambiarEstado,colorPorEstado,formatearEstado,formatearFecha,nombreCompleto};}}</script>
