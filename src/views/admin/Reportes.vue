<template><div class="fade-in"><h2 class="mb-4"><i class="bi bi-flag me-2"></i>Gestión de Reportes</h2><Loading v-if="cargando"/><div v-else class="card"><div class="card-body"><div class="table-responsive"><table class="table table-hover"><thead><tr><th>Fecha</th><th>Usuario</th><th>Título</th><th>Estado</th><th>Asignado</th><th>Foto</th><th>Acciones</th></tr></thead><tbody><tr v-for="r in reportes" :key="r.idReporte"><td>{{ formatearFecha(r.fechaReporte) }}</td><td>{{ nombreCompleto(r.usuario) }}</td><td>{{ r.titulo }}</td><td><span class="badge" :class="`bg-${colorPorEstado(r.estado)}`">{{ formatearEstado(r.estado) }}</span></td><td><small v-if="r.organizacion">Org: {{r.organizacion.nombreOrganizacion}}</small><small v-if="r.veterinaria">Vet: {{r.veterinaria.nombreClinica}}</small></td><td><button v-if="r.fotoUrl" class="btn btn-sm btn-info" @click="verFoto(r.fotoUrl)"><i class="bi bi-image"></i></button></td><td><select class="form-select form-select-sm" :value="r.estado" @change="cambiarEstado(r,$event.target.value)"><option value="Pendiente">Pendiente</option><option value="En_proceso">En proceso</option><option value="Cerrado">Cerrado</option></select></td></tr></tbody></table></div></div></div></div></template>
<script>
import {ref,onMounted} from 'vue';
import Loading from '../../components/common/Loading.vue';
import reporteService from '../../services/reporteService';
import {toast,manejarErrorAPI,alertaHTML} from '../../utils/alertas';
import {colorPorEstado,formatearEstado,formatearFecha,nombreCompleto} from '../../utils/helpers';
export default{name:'AdminReportes',components:{Loading},setup(){const cargando=ref(true);const reportes=ref([]);const cargar=async()=>{try{const r=await reporteService.getAll();reportes.value=r.data;}catch(e){manejarErrorAPI(e);}finally{cargando.value=false;}};const cambiarEstado=async(r,estado)=>{try{await reporteService.update(r.idReporte,{...r,estado});toast('Estado actualizado','success');await cargar();}catch(e){manejarErrorAPI(e);}};const verFoto=(u)=>{alertaHTML(`<img src="${u}" class="img-fluid">`,'Foto');};onMounted(()=>cargar());return{cargando,reportes,cambiarEstado,verFoto,colorPorEstado,formatearEstado,formatearFecha,nombreCompleto};}}</script>
